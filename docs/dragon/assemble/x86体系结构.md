# x86体系结构

80386处理器的三种工作模式

- 实模式

操作相当于一个可进行32位快速运算的8086

- 保护模式

能为内个任务提供一台虚拟处理器，使得每个任务单独执行，快速切换。
可以区分不同的任务使用的存储区域，不允许随便使用其它任务的数据和代码。

此模式下一个内存地址是由段基地址，偏移地址组成。

- 虚拟8086模式


8个32位通用寄存器。

%ebp 栈寄存器

%esp 栈寄存器

保护模式的段模式

段选择器

逻辑地址到物理地址的转换，因为每个任务的地址空间都是一样的。

寄存器没有地址，用名字直接表示。

## 汇编程序的角度

- 指令寄存器：PC（程序计数器），指向下一条指令的地址。（EIP-32或者RIP-64）
- 寄存器和寄存器堆，在处理器内部以名字来访问的快速存储单元。
- 条件码，用于存储最近执行指令的结果状态信息，用于条件指令的判断执行。
- 存储器，以字节编码的连续存储空间，存放程序代码，数据，运行栈以及操作系统数据。

内存就是cpu的外存。


## 汇编程序的数据格式

不同的数据类型在汇编语言中代码的后缀不一样。


## 汇编指令

```
movl Source,Dest
```

- Source,Dest 不能都是内存地址
- 可以是8个通用寄存器
- 可以是立即数
- 可以是内存地址

(%ecx) 代表此时存储的是内存地址。

## 寻址模式

### 间接寻址

movl (%ecx),%eax 代表从地址为(%ecx)的内存中取数据，存入到%eax中 

### 基地址+偏移量寻址

movl 8(%ebp),%edx 代表从地址为(%ebp)+8的内存中取数据，存入到%edx中 


<<< @/example/c/assemble/lab10.c
<<< @/example/c/assemble/lab10.s

%ebp 是基地址，加上偏移量获取到数据。汇编代码有体现。

所以汇编代码是通过地址偏移量体现的真实地址。