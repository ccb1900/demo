<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redux 入门 | 搬砖的故事</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="ico" href="/logo.png">
    <meta name="description" content="java,mysql,php,redis,消息队列,laravel,spring">
    
    <link rel="preload" href="/assets/css/0.styles.e7935bbb.css" as="style"><link rel="preload" href="/assets/js/app.0f5237d9.js" as="script"><link rel="preload" href="/assets/js/1.83683b4b.js" as="script"><link rel="preload" href="/assets/js/135.768bfc5f.js" as="script"><link rel="prefetch" href="/assets/js/10.6aa4c7c2.js"><link rel="prefetch" href="/assets/js/100.754e8d4e.js"><link rel="prefetch" href="/assets/js/101.29fda2c9.js"><link rel="prefetch" href="/assets/js/102.45c7a58e.js"><link rel="prefetch" href="/assets/js/103.419eab41.js"><link rel="prefetch" href="/assets/js/104.97ca4da6.js"><link rel="prefetch" href="/assets/js/105.cd85ab30.js"><link rel="prefetch" href="/assets/js/106.5f7eb675.js"><link rel="prefetch" href="/assets/js/107.341650b4.js"><link rel="prefetch" href="/assets/js/108.fc514448.js"><link rel="prefetch" href="/assets/js/109.29857ba5.js"><link rel="prefetch" href="/assets/js/11.0a96ccf2.js"><link rel="prefetch" href="/assets/js/110.9059cb3e.js"><link rel="prefetch" href="/assets/js/111.f631937b.js"><link rel="prefetch" href="/assets/js/112.3f5a684a.js"><link rel="prefetch" href="/assets/js/113.8bc6ad5b.js"><link rel="prefetch" href="/assets/js/114.a4fda18f.js"><link rel="prefetch" href="/assets/js/115.c6f590ec.js"><link rel="prefetch" href="/assets/js/116.834439c9.js"><link rel="prefetch" href="/assets/js/117.5568cecc.js"><link rel="prefetch" href="/assets/js/118.fc6e11e7.js"><link rel="prefetch" href="/assets/js/119.a24c5ed5.js"><link rel="prefetch" href="/assets/js/12.d54f9206.js"><link rel="prefetch" href="/assets/js/120.38e1cc66.js"><link rel="prefetch" href="/assets/js/121.c7b86ece.js"><link rel="prefetch" href="/assets/js/122.f388d9ca.js"><link rel="prefetch" href="/assets/js/123.4d334a2d.js"><link rel="prefetch" href="/assets/js/124.9f1dbb78.js"><link rel="prefetch" href="/assets/js/125.2b278281.js"><link rel="prefetch" href="/assets/js/126.a5536954.js"><link rel="prefetch" href="/assets/js/127.3300450a.js"><link rel="prefetch" href="/assets/js/128.4603df51.js"><link rel="prefetch" href="/assets/js/129.958f525e.js"><link rel="prefetch" href="/assets/js/13.6e2e83cb.js"><link rel="prefetch" href="/assets/js/130.637b11f1.js"><link rel="prefetch" href="/assets/js/131.3a50074a.js"><link rel="prefetch" href="/assets/js/132.db891beb.js"><link rel="prefetch" href="/assets/js/133.69b4617e.js"><link rel="prefetch" href="/assets/js/134.736d15fc.js"><link rel="prefetch" href="/assets/js/136.3bd0c11d.js"><link rel="prefetch" href="/assets/js/137.cd0faa98.js"><link rel="prefetch" href="/assets/js/138.c8a0d0cb.js"><link rel="prefetch" href="/assets/js/139.0241ebda.js"><link rel="prefetch" href="/assets/js/14.76b10bd0.js"><link rel="prefetch" href="/assets/js/140.a8fb2035.js"><link rel="prefetch" href="/assets/js/141.cc83fc71.js"><link rel="prefetch" href="/assets/js/142.b9ffd43e.js"><link rel="prefetch" href="/assets/js/143.8e1362ce.js"><link rel="prefetch" href="/assets/js/144.1007ad8a.js"><link rel="prefetch" href="/assets/js/145.da52be7a.js"><link rel="prefetch" href="/assets/js/15.fdf646d8.js"><link rel="prefetch" href="/assets/js/16.0547031c.js"><link rel="prefetch" href="/assets/js/17.d9c530b9.js"><link rel="prefetch" href="/assets/js/18.0f29f1eb.js"><link rel="prefetch" href="/assets/js/19.cf91fafd.js"><link rel="prefetch" href="/assets/js/20.c899bc26.js"><link rel="prefetch" href="/assets/js/21.81e9b9f1.js"><link rel="prefetch" href="/assets/js/22.538ecf8a.js"><link rel="prefetch" href="/assets/js/23.e8ccc752.js"><link rel="prefetch" href="/assets/js/24.166e23e1.js"><link rel="prefetch" href="/assets/js/25.0ecb3582.js"><link rel="prefetch" href="/assets/js/26.d7fab674.js"><link rel="prefetch" href="/assets/js/27.a2183b71.js"><link rel="prefetch" href="/assets/js/28.b18c7395.js"><link rel="prefetch" href="/assets/js/29.12f7dabf.js"><link rel="prefetch" href="/assets/js/30.8223d73c.js"><link rel="prefetch" href="/assets/js/31.5628d850.js"><link rel="prefetch" href="/assets/js/32.841dab0e.js"><link rel="prefetch" href="/assets/js/33.73184ce7.js"><link rel="prefetch" href="/assets/js/34.3f01514d.js"><link rel="prefetch" href="/assets/js/35.d1dc78ff.js"><link rel="prefetch" href="/assets/js/36.ad1392e7.js"><link rel="prefetch" href="/assets/js/37.7c512798.js"><link rel="prefetch" href="/assets/js/38.be64330b.js"><link rel="prefetch" href="/assets/js/39.da648c76.js"><link rel="prefetch" href="/assets/js/4.6a1cf263.js"><link rel="prefetch" href="/assets/js/40.446f2422.js"><link rel="prefetch" href="/assets/js/41.ddf839e2.js"><link rel="prefetch" href="/assets/js/42.cb56090a.js"><link rel="prefetch" href="/assets/js/43.ce190009.js"><link rel="prefetch" href="/assets/js/44.dba76b5b.js"><link rel="prefetch" href="/assets/js/45.b87adb14.js"><link rel="prefetch" href="/assets/js/46.a5e01281.js"><link rel="prefetch" href="/assets/js/47.93014ba0.js"><link rel="prefetch" href="/assets/js/48.a24a2508.js"><link rel="prefetch" href="/assets/js/49.77cf6bef.js"><link rel="prefetch" href="/assets/js/5.5dff2bc1.js"><link rel="prefetch" href="/assets/js/50.9d432aae.js"><link rel="prefetch" href="/assets/js/51.e679bac9.js"><link rel="prefetch" href="/assets/js/52.0f928531.js"><link rel="prefetch" href="/assets/js/53.7a1e89e6.js"><link rel="prefetch" href="/assets/js/54.4359f674.js"><link rel="prefetch" href="/assets/js/55.d8236148.js"><link rel="prefetch" href="/assets/js/56.0d328fb2.js"><link rel="prefetch" href="/assets/js/57.10e4ca8c.js"><link rel="prefetch" href="/assets/js/58.c336d3fb.js"><link rel="prefetch" href="/assets/js/59.58dfa219.js"><link rel="prefetch" href="/assets/js/6.b6ebebeb.js"><link rel="prefetch" href="/assets/js/60.5d64dd5a.js"><link rel="prefetch" href="/assets/js/61.ae4ed296.js"><link rel="prefetch" href="/assets/js/62.59de6d0f.js"><link rel="prefetch" href="/assets/js/63.653bd105.js"><link rel="prefetch" href="/assets/js/64.a6af4342.js"><link rel="prefetch" href="/assets/js/65.c694aa2e.js"><link rel="prefetch" href="/assets/js/66.7890fe1b.js"><link rel="prefetch" href="/assets/js/67.6c787509.js"><link rel="prefetch" href="/assets/js/68.a0cfaf46.js"><link rel="prefetch" href="/assets/js/69.7eae9ff0.js"><link rel="prefetch" href="/assets/js/7.2aede8ad.js"><link rel="prefetch" href="/assets/js/70.d0e99f08.js"><link rel="prefetch" href="/assets/js/71.7cc200fe.js"><link rel="prefetch" href="/assets/js/72.d8db7f70.js"><link rel="prefetch" href="/assets/js/73.2210ebd9.js"><link rel="prefetch" href="/assets/js/74.60b66690.js"><link rel="prefetch" href="/assets/js/75.7ce656fa.js"><link rel="prefetch" href="/assets/js/76.68777e95.js"><link rel="prefetch" href="/assets/js/77.b1400d70.js"><link rel="prefetch" href="/assets/js/78.24977ee0.js"><link rel="prefetch" href="/assets/js/79.bb14ea86.js"><link rel="prefetch" href="/assets/js/8.e8196b26.js"><link rel="prefetch" href="/assets/js/80.d069b13b.js"><link rel="prefetch" href="/assets/js/81.39190bbd.js"><link rel="prefetch" href="/assets/js/82.2d2074e7.js"><link rel="prefetch" href="/assets/js/83.e7b1672a.js"><link rel="prefetch" href="/assets/js/84.e1b4b4c2.js"><link rel="prefetch" href="/assets/js/85.5c0e3294.js"><link rel="prefetch" href="/assets/js/86.4a2e7385.js"><link rel="prefetch" href="/assets/js/87.10653c7d.js"><link rel="prefetch" href="/assets/js/88.537d7818.js"><link rel="prefetch" href="/assets/js/89.2a754979.js"><link rel="prefetch" href="/assets/js/9.dca968f6.js"><link rel="prefetch" href="/assets/js/90.d510ccf3.js"><link rel="prefetch" href="/assets/js/91.b5e60963.js"><link rel="prefetch" href="/assets/js/92.3139b24f.js"><link rel="prefetch" href="/assets/js/93.1cba1411.js"><link rel="prefetch" href="/assets/js/94.e08289f5.js"><link rel="prefetch" href="/assets/js/95.d218aa72.js"><link rel="prefetch" href="/assets/js/96.0b7809aa.js"><link rel="prefetch" href="/assets/js/97.bba00897.js"><link rel="prefetch" href="/assets/js/98.051c9edb.js"><link rel="prefetch" href="/assets/js/99.977aeba1.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.a2dc7205.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e7935bbb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">搬砖的故事</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/backend/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/front/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/dragon/" class="nav-link">
  屠龙术
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/recipe/" class="nav-link">
  菜谱
</a></div><div class="nav-item"><a href="/post/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="/app/" class="nav-link">
  应用
</a></div><div class="nav-item"><a href="https://github.com/ccb1900/pages" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/backend/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/front/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/dragon/" class="nav-link">
  屠龙术
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/recipe/" class="nav-link">
  菜谱
</a></div><div class="nav-item"><a href="/post/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="/app/" class="nav-link">
  应用
</a></div><div class="nav-item"><a href="https://github.com/ccb1900/pages" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front/react/react 简介.html" class="sidebar-link">react 简介</a></li><li><a href="/front/react/redux 入门.html" class="active sidebar-link">redux 入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/react/redux 入门.html#react-redux-的模式" class="sidebar-link">react-redux 的模式</a></li><li class="sidebar-sub-header"><a href="/front/react/redux 入门.html#异步逻辑和拉取数据" class="sidebar-link">异步逻辑和拉取数据</a></li><li class="sidebar-sub-header"><a href="/front/react/redux 入门.html#provider" class="sidebar-link">provider</a></li><li class="sidebar-sub-header"><a href="/front/react/redux 入门.html#redux-tookit" class="sidebar-link">redux tookit</a></li><li class="sidebar-sub-header"><a href="/front/react/redux 入门.html#规范化状态" class="sidebar-link">规范化状态</a></li></ul></li><li><a href="/front/react/react hooks.html" class="sidebar-link">react hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/react/react hooks.html#state-hook" class="sidebar-link">state hook</a></li><li class="sidebar-sub-header"><a href="/front/react/react hooks.html#effect-hook" class="sidebar-link">effect hook</a></li><li class="sidebar-sub-header"><a href="/front/react/react hooks.html#hooks-的规则" class="sidebar-link">hooks 的规则</a></li><li class="sidebar-sub-header"><a href="/front/react/react hooks.html#自定义-hooks" class="sidebar-link">自定义 hooks</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Angular</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Android</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>iOS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>桌面</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redux-入门"><a href="#redux-入门" class="header-anchor">#</a> redux 入门</h1> <p>介绍redux是什么以及如何使用redux，由此，对redux有一个宏观的认识。</p> <p>redux包含几个主要元素，state，action,reducer。</p> <ul><li>state
<ul><li>可以是js对象</li> <li>js数组</li> <li>js原生类型</li></ul></li> <li>action
<ul><li>事件</li> <li>一个原生的js对象，描述应用发生了什么</li> <li>action 函数</li></ul></li> <li>reducer
<ul><li>监听器</li> <li>接收state和action作为参数，通过action.type判断事件类型，对state做出处理，返回一个新的状态或者保持旧状态不变。</li> <li>reducer 签名 <code>(state,action) =&gt; newState</code></li> <li><ol><li>基于state和action计算新状态</li></ol></li> <li><ol start="2"><li>不可直接修改旧状态。必须进行不可变更新，复制旧状态修改。</li></ol></li> <li><ol start="3"><li>禁止处理异步逻辑或副作用</li></ol></li> <li>任何遵循这些规则的函数也被称为“纯”函数，即使它没有专门编写为 reducer 函数。</li> <li>为什么这些规则是重要的？
<ul><li>Redux 的目标之一是使您的代码可预测。当函数的输出仅根据输入参数计算时，更容易理解该代码的工作原理并对其进行测试</li> <li>另一方面，如果一个函数依赖于它自身之外的变量，或者它的行为是随机的，你永远不知道运行它时会发生什么</li> <li>如果一个函数修改了其他值，包括它的参数，这可能会意外地改变应用程序的工作方式。这可能是错误的常见来源，例如“我更新了我的状态，但现在我的 UI 没有在应该更新的时候更新！”</li> <li>Redux DevTools 的一些功能取决于你的 reducer 是否正确遵循这些规则</li></ul></li> <li>不可变更新
<ul><li>在redux中永远不允许直接修改state</li> <li>可以使用扩展操作符或者其他函数返回一个copy</li> <li>当数据嵌套时，这变得更加困难。不可变更新的一个关键规则是您必须为需要更新的每一级嵌套制作副本。</li> <li>手写不可变更新的逻辑是困难的，容易犯错的。所以我们需要redux toolkit，来简化不可变更新的编写。</li></ul></li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>安全的修改状态</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>state<span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token number">123</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <ul><li>副作用
<ul><li>从函数返回值之外可以看到的对状态或行为的任何更改</li> <li>例如
<ul><li>打印到控制台</li> <li>保存到文件</li> <li>设置异步定时器</li> <li>http 请求</li> <li>修改存在于函数之外的某些状态，或改变函数的参数</li> <li>生成随机数或唯一的随机 ID (<code>Math.random() or Date.now()</code>)</li></ul></li></ul></li> <li>分割reducer
<ul><li>根据状态对reducer进行分割，解决数据嵌套的问题。</li> <li>每个reducer更新一部分状态</li> <li>这称为 reducer 组合，它是构建 Redux 应用程序的基本模式。</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">todoSlice.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'Learn Redux'</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token string">'purple'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token keyword">function</span> <span class="token function">nextTodoId</span><span class="token punctuation">(</span><span class="token parameter">todos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> maxId <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">maxId<span class="token punctuation">,</span> todo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">,</span> maxId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> maxId <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> <span class="token function-variable function">todosReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> state
        <span class="token keyword">case</span> <span class="token string">'todos/todoAdded'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>
                <span class="token operator">...</span>state<span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    id<span class="token operator">:</span> <span class="token function">nextTodoId</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    text<span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span>
                    completed<span class="token operator">:</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <ul><li><p>组合reducers</p> <ul><li>分久必合</li> <li>根reducers是必须的，对slice reducer进行组合。</li></ul></li> <li><p>store</p> <ul><li><p>全局唯一</p></li> <li><p>在里面保存当前的应用程序状态</p></li> <li><p>可以获取当前状态</p></li> <li><p>dispatch</p></li> <li><p>subscribe</p></li> <li><p>unsubscribe</p></li> <li><p>创建 store</p></li> <li><p>加载初始状态</p> <ul><li>例如包含在从服务器发送的 HTML 页面中的值，或持久保存在 localStorage 中并在用户再次访问该页面时回读的值</li></ul></li> <li><p>enhancers</p> <ul><li>对store做一些定制</li></ul></li> <li><p>middleware</p> <ul><li>dispatch 进行一些个性化操作</li> <li>Redux 中间件在分派动作和它到达reducer的那一刻之间提供了第三方扩展点。
<ul><li>打印日志</li> <li>冲突报告</li> <li>异步api</li> <li>路由等等</li></ul></li> <li>使用中间件
<ul><li>Redux 中间件实际上是在 Redux 内置的一个非常特殊的 store 增强器之上实现的，称为 applyMiddleware</li></ul></li> <li>中间件可以有副作用</li> <li>中间件在dispatch逻辑之前执行
<ul><li>The print1 middleware (which we see as store.dispatch)</li> <li>The print2 middleware</li> <li>The print3 middleware</li> <li>The original store.dispatch</li> <li>The root reducer inside store</li></ul></li> <li>定制中间件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">exampleMiddleware</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">storeApi</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;dispatch start&quot;</span><span class="token punctuation">,</span>action<span class="token punctuation">.</span>type<span class="token punctuation">,</span>action<span class="token punctuation">)</span>
            <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;dispatch end&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span>
            <span class="token keyword">return</span> result
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></li></ul></li> <li><p>todoApp</p> <ul><li>action
<ul><li>add a todo</li> <li>todo 的完成状态</li> <li>删除todo</li> <li>清除已完成todo</li></ul></li></ul></li></ul> <h2 id="react-redux-的模式"><a href="#react-redux-的模式" class="header-anchor">#</a> react-redux 的模式</h2> <p>全局状态，组件状态，表单。整个应用程序所需的全局状态应该放在 Redux Store 中。只在一处需要的状态应该放在组件状态</p> <h2 id="异步逻辑和拉取数据"><a href="#异步逻辑和拉取数据" class="header-anchor">#</a> 异步逻辑和拉取数据</h2> <ul><li>使用redux thunk 中间件，官方的异步函数中间件。允许直接dispatch异步函数</li></ul> <h2 id="provider"><a href="#provider" class="header-anchor">#</a> provider</h2> <h2 id="redux-tookit"><a href="#redux-tookit" class="header-anchor">#</a> redux tookit</h2> <ul><li>configureStore
<ul><li>组合reducers</li> <li>创建store</li> <li>自动添加thunk中间件</li> <li>自动增加一些错误检查的中间件</li> <li>自动设置redux开发工具扩展</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  reducer<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Define a top-level state field named `todos`, handled by `todosReducer`</span>
    todos<span class="token operator">:</span> todosReducer<span class="token punctuation">,</span>
    filters<span class="token operator">:</span> filtersReducer
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><ul><li>包更干净了
<ul><li>自动包含redux，redux-thunk，reselect</li></ul></li> <li>createSlice
<ul><li>name，生成的action的前缀</li> <li>initialState，初始状态</li> <li>reducers 一个对象，其中键是字符串，值是将处理特定操作的“case reducer”函数</li> <li>自动生成action</li> <li>使用了immer，因此可以在reducers中进行可变更新</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createSlice <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> todosSlice <span class="token operator">=</span> <span class="token function">createSlice</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'todos'</span><span class="token punctuation">,</span>
  initialState<span class="token punctuation">,</span>
  reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">todoAdded</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ✅ This &quot;mutating&quot; code is okay inside of createSlice!</span>
      state<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">todoToggled</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> todo <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
      todo<span class="token punctuation">.</span>completed <span class="token operator">=</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>completed
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">todosLoading</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        status<span class="token operator">:</span> <span class="token string">'loading'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> todoAdded<span class="token punctuation">,</span> todoToggled<span class="token punctuation">,</span> todosLoading <span class="token punctuation">}</span> <span class="token operator">=</span> todosSlice<span class="token punctuation">.</span>actions

<span class="token keyword">export</span> <span class="token keyword">default</span> todosSlice<span class="token punctuation">.</span>reducer

</code></pre></div><div class="language- extra-class"><pre><code>- createAsyncThunk
</code></pre></div><h2 id="规范化状态"><a href="#规范化状态" class="header-anchor">#</a> 规范化状态</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新时间:</span> <span class="time">12/17/2021, 1:28:52 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/front/react/react 简介.html" class="prev">
        react 简介
      </a></span> <span class="next"><a href="/front/react/react hooks.html">
        react hooks
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0f5237d9.js" defer></script><script src="/assets/js/1.83683b4b.js" defer></script><script src="/assets/js/135.768bfc5f.js" defer></script>
  </body>
</html>
